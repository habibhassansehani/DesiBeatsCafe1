# Vercel Deployment Guide - Desi Beats Cafe POS

This guide explains how to deploy the Desi Beats Cafe POS system to Vercel.

## Prerequisites

1. A [Vercel account](https://vercel.com/signup)
2. A [MongoDB Atlas account](https://www.mongodb.com/cloud/atlas) (free tier available)
3. An [ImageKit account](https://imagekit.io/) for image uploads (free tier available)
4. Your project pushed to a Git repository (GitHub, GitLab, or Bitbucket)

## Step 1: Prepare Your Database

### MongoDB Atlas Setup

1. Go to [MongoDB Atlas](https://cloud.mongodb.com/)
2. Create a new cluster (free M0 tier works fine)
3. Click "Connect" on your cluster
4. Choose "Connect your application"
5. Copy the connection string (looks like: `mongodb+srv://user:password@cluster.mongodb.net/database`)
6. Replace `<password>` with your actual password
7. Add your database name at the end (e.g., `desibeats-pos`)

**Important:** In MongoDB Atlas Network Access, add `0.0.0.0/0` to allow connections from Vercel's dynamic IPs.

## Step 2: Get ImageKit Credentials

1. Go to [ImageKit Dashboard](https://imagekit.io/dashboard/developer/api-keys)
2. Copy your:
   - **Public Key** (starts with `public_`)
   - **Private Key** (starts with `private_`)
   - **URL Endpoint** (e.g., `https://ik.imagekit.io/your-id`)

## Step 3: Deploy to Vercel

### Option A: Deploy via Vercel Dashboard

1. Go to [Vercel Dashboard](https://vercel.com/dashboard)
2. Click "Add New" → "Project"
3. Import your Git repository
4. Configure the project:
   - **Framework Preset:** Other
   - **Build Command:** `npm run build`
   - **Output Directory:** `dist/public`
   - **Install Command:** `npm install`

### Option B: Deploy via Vercel CLI

```bash
# Install Vercel CLI
npm i -g vercel

# Login to Vercel
vercel login

# Deploy (from project root)
vercel

# For production deployment
vercel --prod
```

## Step 4: Configure Environment Variables

In your Vercel project settings (Settings → Environment Variables), add these variables:

| Variable | Value | Environment |
|----------|-------|-------------|
| `MONGO_URI` | Your MongoDB connection string | Production |
| `JWT_SECRET` | A random secret string (32+ chars) | Production |
| `IMAGEKIT_PUBLIC_KEY` | Your ImageKit public key | Production |
| `IMAGEKIT_PRIVATE_KEY` | Your ImageKit private key | Production |
| `IMAGEKIT_URL_ENDPOINT` | Your ImageKit URL endpoint | Production |
| `VITE_IMAGEKIT_PUBLIC_KEY` | Same as IMAGEKIT_PUBLIC_KEY | Production |
| `VITE_IMAGEKIT_URL_ENDPOINT` | Same as IMAGEKIT_URL_ENDPOINT | Production |

**Generate a JWT Secret:**
```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

## Step 5: Seed the Database (First Time Only)

After your first deployment, you need to seed the database with initial data:

### Option 1: Use Local Script
```bash
# Set your production MONGO_URI locally
export MONGO_URI="your-production-mongodb-uri"

# Run the seed script
npx tsx scripts/seed-menu.ts
```

### Option 2: Create Admin User Manually
The system auto-creates a default admin user on first API call:
- **Username:** admin
- **Password:** admin

**Important:** Change this password immediately after first login!

## Project Structure for Vercel

```
├── api/
│   └── index.js          # Serverless API function (all routes)
├── dist/
│   └── public/           # Built frontend (generated by npm run build)
├── vercel.json           # Vercel configuration
└── package.json
```

## How It Works

1. **Frontend:** Built with Vite, served as static files from `dist/public`
2. **Backend:** Single serverless function at `api/index.js` handles all `/api/*` routes
3. **Database:** MongoDB Atlas (serverless-compatible with connection pooling)
4. **Images:** Uploaded to ImageKit CDN, URLs stored in MongoDB

## Troubleshooting

### "Function Timeout" Errors
- Increase `maxDuration` in `vercel.json` (max 60s on Pro plan, 10s on Hobby)
- Cold starts may cause initial slowness

### "Cannot connect to MongoDB"
- Ensure `0.0.0.0/0` is in MongoDB Atlas Network Access
- Verify your `MONGO_URI` is correct and includes the database name

### "ImageKit Authentication Failed"
- Verify all ImageKit keys match (public key on frontend = same account as private key on backend)
- Check that `VITE_IMAGEKIT_PUBLIC_KEY` matches `IMAGEKIT_PUBLIC_KEY`

### "Module not found" Errors
- Run `npm run build` locally to test the build
- Ensure all imports use correct paths

## Environment Variables Reference

```env
# Required
MONGO_URI=mongodb+srv://user:pass@cluster.mongodb.net/desibeats-pos
JWT_SECRET=your-random-secret-key-32-chars-minimum

# ImageKit (for image uploads)
IMAGEKIT_PUBLIC_KEY=public_xxxxx
IMAGEKIT_PRIVATE_KEY=private_xxxxx
IMAGEKIT_URL_ENDPOINT=https://ik.imagekit.io/your-id

# Frontend ImageKit (same values, VITE_ prefix for client access)
VITE_IMAGEKIT_PUBLIC_KEY=public_xxxxx
VITE_IMAGEKIT_URL_ENDPOINT=https://ik.imagekit.io/your-id
```

## Post-Deployment Checklist

- [ ] Verify the app loads at your Vercel URL
- [ ] Login with default admin credentials
- [ ] Change the admin password immediately
- [ ] Test creating an order
- [ ] Test image upload for products
- [ ] Set up a custom domain (optional)

## Custom Domain Setup

1. In Vercel Dashboard → Your Project → Settings → Domains
2. Add your custom domain
3. Update DNS records as instructed by Vercel
4. Wait for SSL certificate provisioning (automatic)

## Support

For issues with:
- **Vercel:** [Vercel Documentation](https://vercel.com/docs)
- **MongoDB Atlas:** [MongoDB Docs](https://www.mongodb.com/docs/atlas/)
- **ImageKit:** [ImageKit Docs](https://docs.imagekit.io/)
